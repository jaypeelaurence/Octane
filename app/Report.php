<?php

namespace App;

use Illuminate\Support\Facades\DB;
use Illuminate\Http\Response;
use Illuminate\Database\Eloquent\Model;

class Report extends Model
{
    function __construct(){
        $this->query = DB::connection('mysql2'); //dummy_db
    }

    public function listAccount(){
        return $this->query->table('esme_credential')->select('id','system_id')->get();
    }

    public function listSender($id){
        $accountId = $this->query->table('esme_credential');
        $accountId->select('allowed_sender_ids');
        $accountId->where('esme_credential.id', $id);
        $accountId->get();

        if(count($accountId->get()) != 0){
            // $senderId = explode("|", $accountId->get()[0]->allowed_sender_ids, -1);

                $string = "101newyork|123 legal|123lending|12sms|1521resto|1988devcorp|1bro|1digmaan|1isa|1lgbt|1qt|1stvitaplus|1xbet.com|24-7|2600promo|2blive|2go|360fitclub|361degrees|4dsr|4life-usa|4lifeagilas|5 anchors|5light|632beer|7-11|7-eleven|700club|7eleven|8990deca|8apps|8thsaps|9dot_strat|9dotstrat|a3d|aa_masaje|aaa prx|aaa_prx|aaron|aaron carlo|aathletica|aava|abank|abiva|abizo|aboitiz|aboitiz.|aboitizpowr|abs-cbn|abuelitas|acacia-pc|accenti|accor|acctn|accu|accucel|acdi mpc|acdi_mpc|ace promo|acerd|aclc-alab|acnresponse|acrobat|adamson|adamsonu|adamsonuni|adb|adb oist|adb otp|adb-oist|adb-otp|adbotp|adgateway|admerex|admin|adocuenca|adore|adsai|adspark|ae|aegle|aeo|aeon|aeon credit|aerolineas|aerosmith|aerosvit|aev-csd|aev-soc|aevcsd|aevhr|aevsoc|aexponents|affordnails|affos|aficionado|afield|afmobi|afp|afpgen|afpmbai|afpslai|afse|afsenat|afseupdate|agape|agb|agenda|agent|agilapadala|agp|agp_corp|agribank|agronomika|ahnex|aibc|aim|aim global|aim-hrs|aipsurvey|air21|airasia|airasiaph|airbnb|airpay|airserbia|airspring|ait-bsc|aitbusiness|aitbuss|aivee|akcija|aksyonradyo|akulaku|al-raed|alai|alamat|alano&sons|alansari ex|alaskacycle|alaskaikids|alassal|alcala|aldrin|alerts|algar|alitalia|aljay|all access|allied|allied bank|alliedb|alliedbank|alliedcredit|alliedpnb|alliedpromo|allphones|alphat_taxi|altshiftph|alu_hotel|aluhotel|alviera|ama|ama univ|ama_srhigh|amaddarfo1|amaddarfu1|amaes|amara|amasrhigh|amauniv|amazon|amazonph|amcham inc.|amdocs|ameliahomes|americain3d|amerikaatbp|ametech us|ametros|ametros_inc|ameu|ameu.com.ph|amex|amici|amiya_rosa|amps|amreco|amway|amwayph|amwslai|andbnk|andersonph|andy_reyes|angbalangay|angelo|angkas|annchamfort|anne|anne galing|annenicole|annsdfic|ant_city|anthem|antriku|anz|anz bank|anz-nz|ap trading|ap-oaxs|ap_oaxs|ap_trading|apamst|apaoxs|apc|apc_best|apec2015|aplans|aplans 3|aplic_2013|aplus|apmktg|apn|apoaxs|appfactory|appi|apple|appleph|appsolutely|aprcc2015|aprce2015|apri|aquabest|aramex|araneta_ctr|archico|ardie malit|ariva|arko|armmdeped|armmnat|armmnews|armmupdate|arowai|arqcurtains|artista|artofliving|artofscent|asaisoft|ascc|ascco|ascender|ashop|asiacold|asiamiles|asianetwork|asianfinds|asianic|asianlife|asiapay|asiasoft|asiatel|asiatravel|asis phil|assurantbpo|aster|astrotrivia|ata_group|atc|atc health|atc_health|ate nes|ate ness|athoc|atin|attigo|atts|aub|aub cards|aub due amt|aubcards|aubdueamt|aubsms|aui ewb|aui scb|aui_ewb|aui_scb|aurabliss|ausphilfx|authmsg|autoallee|autohub|automatictr|automechphl|autostrada|autosweep|autoworkz|auxplus|avalonedu|avis|avis_ph|avlci|avolution|avon|avon_its|awwc|axa life|axa ph|axaphil|axisbk|ayala|ayala plans|ayala__land|ayala_land|ayalacebu|ayalamalls|ayannah|azulland|b and p|b&p|b&w|b-meg|b. lounge|b.a.o.n.|b1g singles|b612|babyexpo.ph|babyshop.ph|bacoornews|badabee|badoo|bafaventra|bahai.ph|bahayfinder|balesin|balita|balkan|baltintbank|bananarep|banapple|bancnet|bancreateam|band|bangkokair|bangkokbank|banilgu-cec|bank_makati|bankard|bankcom|bankofchina|baon|basf|bastacondo|bastion|batikair|bayadcenter|bayantel|bayo|bazooka|bb_service|bbd_farah|bbm|bbr bank|bbservice|bbx|bcbp-gh|bcbpcdoeast|bcbpnac37|bcode|bcta|bctaupdates|bctravelph|bdj team|bdo|bdo amg-su|bdo amg-suu|bdo rewards|bdo treats|bdo(.*)|bdo- cards|bdo-aloans|bdo-aloanu|bdo-atm|bdo-bob|bdo-bobu|bdo-cards|bdo-cardsu|bdo-careeru|bdo-cbn|bdo-cbnu|bdo-ccc|bdo-ccc-bsd|bdo-cccu|bdo-dco|bdo-dcou|bdo-diners|bdo-disg|bdo-disgu|bdo-ebank|bdo-ebanku|bdo-hloans|bdo-hloanu|bdo-homeu|bdo-insure|bdo-mpay|bdo-nerveu|bdo-nomura|bdo-nomuru|bdo-online|bdo-onlinu|bdo-otp|bdo-otpu|bdo-pay|bdo-ppmcu|bdo-remit|bdo-remitu|bdo-rewards|bdo-rewardu|bdo-rmuautu|bdo-rmuhomu|bdo-sbloans|bdo-sbloau|bdo-treats|bdo_dev|bdo_rewards|bdodev2|bdohau|bdolife|bdolifebanc|bdolifenbu|bdolifeserv|bdopay|bdorw|bdotreats|bdou|bdounibank|bdounibanku|bds_itech|bdsitech|be|beam|beamandgo|beanfun|beerent|beetalk|belle|bellevue|bellvu5150|belmont|belvedere|benecol|benedictine|benefitph|bensimon|besthome|bestproduct|bestwestern|bethel|bevs travel|beyond2014|bfb|bgccyclephi|bh6750|bicolnon|bicolnon.com|bigbenta|bigboss|bigmk inc|bigoli|bigolive|bikramyoga|billy|binalot|biocare|bistro grp|bit noc|bitbit|bitdefender|bitholic|bitholice|bizmoto|bkdelivery|bkfep|bkfep.com|blast|blendr|bli|blindspot|blink|blitz|blockchain|blogapaloza|blss swim|blsswim|bluebeexprs|bluecross|blwc|bmeandt|bmi|bms motors|bmsmotors|bmw mission|bnet|bng|bngobonanza|bnhs|bnhsnat|bnkofmakati|boardroom|boardwalk|boardwalkhr|bobble|bolt|bom|bonus club|boone|borland|bos coffee|bp|bpi|bpi cards|bpi epay|bpi family|bpi m/s|bpi mobile|bpi ms|bpi ocsu|bpi otp|bpi/ms|bpi123|bpiamore|bpicallcent|bpicard|bpicards|bpidev|bpifamily|bpims|bpims cco|bpims insce|bpithrills|bpo|bpochub|bradford|brand.name|branded.sms|branded_sms|brandedge|brandinfo|brandsms|brandtext|brehms|brgy.glagro|bridgecom|british emb|bro|bro. henry|broburg|brokerhouse|brown|brunphil|bsau_org|bshomes|bsm|bsmc|budgetload|buffalo|buka africa|bukongpinoy|bumble|bunappetit|buqo|burlington|bussvideos|bustrack|busybee|bux|buyanihan|buybitcoin|bwmanila|by sonja|bysonja|c&b|c-one|c2cuisine|cafeshibuya|cagelco 2|cagelco ii|cagelco2|caih|callcarlo|caltex|caltex-hp|camella|camp1-play|canadianpro|candb|cannorth|canon|canon_pixma|canyoncove|canyonranch|canyonwoods|capitalife|capitaluptc|capsule_tsa|captal uptc|card|card_bank|cardbank|cardcontrol|cardpioneer|careem|careerfindr|cargo king|cargoking|cari|caritas|carvs|casablanca|casabocobo|cash|casha|cashexpress|catalysts|cataquiz|catch|cavalli|caymanair|cbc trust|cbc-cards|cbc_atm|cbc_bcp|cbc_cards|cbc_cashmgt|cbc_cbghome|cbc_crcards|cbc_jmp_now|cbc_mobile|cbc_online|cbc_pcci|cbc_promo|cbc_remit|cbc_soa|cbc_tlrfone|cbc_trust|cbc_usage|cbm|cbn|cbnu|cbs|cbs_acd|cbs_atm|cbs_bcp|cbs_cashmgt|cbs_mobile|cbs_online|cbs_tlrfone|cbsi|cbsi_dep|ccf friends|ccf-taytay|ccgsqcpd|ccgsqcs|ccgsqspd|cd|cdm program|cdnms|cdnmsilagan|cdnmsroxas|cdo_sale|cdqo|cebuana|cebupac|celine|celtech oc|cenr albera|cenr alcala|cenr alista|cenr almnos|cenr aparri|cenr argao|cenr aritao|cenr ayungn|cenr bagac|cenr bagnga|cenr bago|cenr baguio|cenr bangui|cenr bantay|cenr baybay|cenr bayugn|cenr bguias|cenr bislig|cenr blison|cenr bngued|cenr bnuevo|cenr brkspt|cenr brngan|cenr bunawn|cenr cadiz|cenr calnsn|cenr cantln|cenr capas|cenr cauayn|cenr cbagan|cenr cbantn|cenr cbdbrn|cenr cebu|cenr claca|cenr clauag|cenr cmling|cenr conner|cenr coron|cenr csgurn|cenr ctblgn|cenr ctnuan|cenr ctrman|cenr culasi|cenr davao|cenr dcrlos|cenr dgupan|cenr diffun|cenr digos|cenr dngaln|cenr dnlphn|cenr dolors|cenr dumgte|cenr dupax|cenr gensan|cenr glan|cenr gngoog|cenr gnobtn|cenr goa|cenr guimbl|cenr guipos|cenr iligan|cenr imelda|cenr initao|cenr iriga|cenr kbnkln|cenr kbslan|cenr kiamba|cenr klmbgn|cenr klmnsg|cenr lamut|cenr laoag|cenr lianga|cenr lilang|cenr liloy|cenr lipa|cenr loreto|cenr lupon|cenr maasin|cenr maco|cenr manay|cenr manukn|cenr mati|cenr mdsyap|cenr mfrtch|cenr mlalag|cenr mobo|cenr monkyo|cenr msnloc|cenr mtalam|cenr munoz|cenr muã±oz|cenr nasipt|cenr ncrlla|cenr ngllan|cenr ngtpnn|cenr olngpo|cenr oroqta|cenr ozamis|cenr palann|cenr palo|cenr panabo|cenr pgblao|cenr pgsnjn|cenr pinan|cenr piã±an|cenr pmbjan|cenr pnkpuk|cenr pprnsa|cenr pracls|cenr quezon|cenr real|cenr rmgsay|cenr roxasm|cenr roxasp|cenr sara|cenr sblyan|cenr sbngan|cenr siocon|cenr sisdro|cenr sjcnto|cenr snjose|cenr snjuan|cenr socoro|cenr solana|cenr spocot|cenr srallh|cenr srfael|cenr strita|cenr szmira|cenr tabang|cenr tabuk|cenr talakg|cenr talcgn|cenr talibn|cenr taytay|cenr tcrong|cenr tgblrn|cenr tgudin|cenr tubod|cenr urdnta|cenr vlncia|cenr zmbnga|centili|centrio|century|century5150|century703|cepalco|cf pavilion|cfcsupport|cfcuser|cfs|cgbp|chana|chapelier|chaton|chatsauce|chatsaucetm|checkers|chedro12|chef_tanke|cherry|cherrymob|cherrymobil|chevy_otis|chill-out|china|china_expo|chinabank|chinaexpo|chinairline|chinmayaph|chix22|chix23|chiyoda_ph|chocol8mint|chookstogo|chowking|chowparedes|chris|chronotron|chrysler|chrysler ph|chuckie|chulien|chulien.com|chumslive|ciano|cibo|cid|ciit|cinteractiv|cip|circle|cirrio|cite|citi|citialert|citibank|citibankph|citibankuat|citiglobal|citigroup|citiph|city club|citypoynt|citysavings|citywatch|cj|cjhgolfclub|ckdelivery|clarity|clcefi|clctn|clean|cleanair ph|cleanhome|clfg|clickme|clickshopph|climbs_coop|clinica mla|clinica_mla|clinique|cliqnship|cliqq|cln_celine|cloudcom|cloudsms|clpc|clsu|clubfactory|clubgourmet|clubhotel|cm|cmad|cmcm|cme partner|cmonwealth|cmrc|cninfo|cobalt|cobraim703|coc|coca-cola|cocacola|cocochicka|cocolife|cod hr|cod im|cod it|cod manila|cod slot|cod tg|cod_bacoor|codeslaves|coins ph|coins.ph|coinsph|coke|coldcloud|collect|colormanila|columbia|comasia|comcell|comclark|comgtech|complex|comquest|comtech|conflux|converge|cookapps|coreware|corner|coshemap|cpg|cpgi|cratebarrel|cravings|crdmendoza|creativetec|credits|crimson|crystalplus|cs wifi|csafp|csg_alerts|cssc win|ctbc|ctbc bank|cthread|ctm|ctpl|ctsi-chld|ctsi-ph|ctsi-phil|cubed|cul_inc|cumc|cumchosptal|cup|cwslai|cybersoft|czarina|d.blooms|d2bukidnon|d5|da5|da5admin|da5office|da5ph|dahansms|dakotafarah|dalton|dance plus|danske bank|daompc|darf01|data1asia|daum|davaolight|dayre|dbp|dbs-manila|dbs.manila|dbtccebu|dc-admin|dc-pnp|dcfc|dcs|dctech|dealdozen|deals101|delhatulan|deliciousdt|deliverclub|deliveree|delivery|demo|denr|denr - car|denr - ncr|denr - r1|denr - r10|denr - r11|denr - r12|denr - r13|denr - r2|denr - r3|denr - r4a|denr - r4b|denr - r5|denr - r6|denr - r7|denr - r8|denr - r9|denr-lmb|denr-r0ss|denr-r8oss|dentsuph|deped|depednat|depedro12|dermclinic|dermpharma|devsmx|dex_qua|dexqua|dexter|dexter tan|dfs|dhanbk|dhayday|dhl|dhl express|diabetasol|dice205|digicon|digicon cdm|digima|digital|digitalfcb|digitallb|digitalmktg|digitalmoz|dilg|dimavemc|diners_club|directlink|directo|dirty app|dite|dittotv|dlpc|dlsmc|dlsmc med|dlsmc_cc|dlsmc_hr|dlsmc_it|dlsz|dmci|dmcibilling|dmcicc|dmcifinance|dmcihomes|dmcihrd|dmcinews|dmcitreas|dmns_glass|dms|dms.billing|dms.invoice|dmsph|dnc|docusign|dole oshc|dole12|dolexii|don_vega|dondy|donners|donotreply|dontalk|dot.uni.ph|dove|doxcheck|doxpro|dpwh|dragonfruit|dragonpay|driven|driven info|driven-mktg|drivenpromo|drumstick|dsar|dsas|dsas2015|dss_manila|dswd|dtc mobile|dtc_mobile|dtcmobile|dtro|dtsi|dtw|dupont|dxn|dxn phils|dxnphils|dynamite|dynapharm|dywong|dzrh|e ccpadala|e-cc padala|e-ccpadala|e-methods|e-num|e-pda|e-peso|e-xchangeph|e._seton|e_banking|e_seton|eacsi|eaglecement|eaglepoint|easimed|eastern|eastwest|easy_taxi|easycash|easyrock|easystore|easytaxi|easytrip|eb|ebank|ebay|ebeneezers|eca phils|ecash|eccpadala|eci|ecoverde|ecpay|ecs|ectk|edsitjar|edupro|edwin|efe.ph|efun|egcbpartner|egcdistrib|egiftcard|egivecash|eica|eksms|elanvital|elastoseal|elcenter|elcielito|elescaler|els support|email|emapta|embassy|emerch|emergency|emfoplus|emirates|empire east|empire_east|emporia|emporiaplus|empower|emreach|ems|en missions|enablesms|enc makati|enchanted k|enjoyphil|entrepbank|eobot|eon|eongold|epayments|epayroll|epayvenue|epeso|eph_bdm|eph_secure|epicurious|epinoy|epinoyload|eplatform|epoxy|epvia|eqb|eqqui|equicom|equicombank|equipment|er_foods|erc|erhcatering|eric_lindo|ericsson|ericssonceo|erim|erimbc|erimexpress|erwan|escrow.wm|espada|esquire|ess|essenxa|ethan_allen|ethanallen|ethiopian|etihadair|etopian|etracker|events|evm awards|ewallet|ewb|ewb-cib|ewbautoloan|ewbhomeloan|ewbrb|ewrb|ewu|exakt|excard|exclusif|exlink|exlinkevent|exotica|expedia|expobank|expressflwr|expresspay|exsite|ezential|ezviz|ezycourier|f-club|facebook|factst|fameux|family|familymart|faph2016|faphl2016|fastcargo|fastlane_ph|fastlaneph|fastnet.ph|fastrack|fastrackph|fbc50|fcb_bohol|feiyie7|fern|fern_inc|ferrer_2013|fgh|ficc|ficco|fico|fiesta|figaro co|figaro co.|fil-mus|filpet|finance|fireproof|firestopper|firstmetro|fisher_mall|fitness1st|fitness_1st|flamingo|florabel|flytpack|flytpact|fogcity|fogwarenews|folded&hung|follicles|foodpanda|foosball ph|ford|forestlodge|forever 21|forever21|foreverrich|fornax-fss|fornax-fssi|fortrushph|fortrustph|fortruth|fortunelife|forum gh|four1splore|foxtravel|fpanda|fpp|frazzled|free|free games|free load|freeinfo|freshfrgbar|freshmind|frim|frpi|frtech|frtechinc|fruits|fruitwishes|ftv|fu-express|fun.g soap|fundko|fungisol|funtasticph|fusion360|futurenet|futureproof|g12aguilas|gainersgrp|galileo|gamania|gameloft|gamenah|garcias_p|gardner|garena|gash|gates|gates vu|gates-vu|gawin.ph|gc_load|gcload|gdg|gdiph|gdmpccares|gecc|geg-ph|gegph|gemilang|gemilang4u|gemmary|gen3_2013|gene_tapia|generali|genspeed|gess|get360fit|getmore.ph|getzpharma|gexpress|giant|giantapp|gift it|gin|gin123|ginsengph|gionee|giordanoph|girbaud|girlteki|giss|gisspzero|gisszero|glibt|glide|glinkr|gll|glmp|glob|global-link|globallink|globalsms|gloner|glorietta|glory|glp|gma7|gmacsg7|gmapinoytv|gmax|gmci|gmet|gmet trd|gmp|gms|gmt|gmx|go-bike|go-jek|gobike|gobuy|godli|gogo hunt|gogohunt|golden life|goldenratio|goldilocks|golive|gongcha|good life|goods|goods ph|goods.ph|goodsph|google|googleph|gop digital|gop phil|gotitall|gourmet|govhataman|govremulla|govsato|goworldwide|gppi|gppi-csd|gppi-hr|gqwest|grab|gracel|gracepoe|grandvilla|grasparin|greatminds|green_2000|greenbelt|greenhouse|greenpeace|greenpeso|greenph|greenphils|greenspan|greenwich|growthscout|grub club|gs salon|gs_salon|gsd-maint|gsis|gsms|gsmunlock|gsorbetero|gss|gtarcade|gtg_letsgo|guess|gulfair|gus*|gvplus|gvx|gw1948|gw469|gwdelivery|gwibsi|gwu|gwws|h&a_diamond|h.chapelier|ha_diamond|habitat|habitat_msg|habitatphil|hai-o|hairzone|hallo2mall|hallohallo|hannahs|hanpax|happyfresh|happyrooms|harborpoint|has|hasminclass|haulio|havaianas|hawaiian|hawaiians|hazel|hbdpartners|hcic-sms|hcl|hclthr|hcpi|hcpt_it|hcpti|hcpti_hrd|hcpti_ict|hcpti_mktg|hcpti_optn|hcpti_sfty|hcpti_tqm|hdfcbank|headware|healthway|healthwaym|hellofood|henlin|hennessy|herbalife|herbalifeph|hermosa-ctv|heropal|hertz|heykuya|hfood|hi-safety|highendcars|highlands|hike|himalaya|himap|hiprecision|hirna|hirnataxi|hitech|hizonscater|hkolpinas|hlbank|hlhuillier|hmoneda|hmrc|hncs|hncstanza|holcim|holyspirit|home credit|homecredit|homematch|homitori|honda|hooch|hooq|hoppler|hostkey|hot star ph|hotel_h2o|hotelshow|hotflopz|hotfm|hotornot|hotspotvpn|housal inc.|hovono|hr|hrhero|hrpp|hsbc|hsbcraffle|hsbcredeem|hslbraille|htech|http-api01|http-api02|huawei|huggle|hungry.ph|hvacr|hvacrphils|hyundai|hyundaipque|i am|i love mgc|i-fern|i-pcv|i-pvg|iacademy|iam|ibarras|ibbl|ibrt|ic_manila|icafe|icare|icart|icicip|icq|icqmobile|ict|idcj|ideal86|idealcon|ideals86|ideliver101|ideo|idm2016|idp|idp.ielts|idp_ielts|idpielts|idpph|idwf2016|ieca youth|ifern|iflick|iftinxpress|ignisfx|ihg|ihisst|iiap-cert|iiap-mem|iiap-pd|ikon|ilocos tour|ilovemgc|iloveyou|im703davao|imanila.ph|imaxtech|imculinaire|imhopeful|imimob|imitst|imo|imperial|imsorry|imusdeped|imusnat|imx it|inc|inc pquemms|inctv|indusb|inett|infini|infinit3|infinity|infinity_s|info|infoalert|infobank|infobip tfa|infomsg|infonote|informatics|infosms|infotxt|infoverify|infthk|innovateoap|innovathink|innovestfx|ins|inscol|inspire_inc|inspiredads|instafin|instagram|instantcash|insularlife|insurdirect|intelli|inteluck|interglobe|intra|invecs|investexpo|ioebcc|iolytes|ion|iot|ipams|ipho-lanao|ipruhr|ipruli|ipsentry|ipsys tech|ipsystems|iq|irctci|iremit|iremitau|iris|irishpotato|ironman|ironmanphil|iroseph|iscahm|isehati|isip ph|isip_ph|isla lipana|island-news|ist|isu roxas|isu-roxas|iswatch|it group|itac|itake1|itake2|itake3|itake4|itake5|itake6|italembph|itallianis|itasms|itatva|itc|itprosasia|itslikecash|itwosms|ivolunteer|iwave_bank|iwave_otp|ixbase|ixsolutions|jacctags|jacplus|jadegroup|jadepacific|jakebros|jam|jarvis|javitaph|jbbaguio|jbcavite|jbcebu|jbdel|jbdelivery|jberberabe|jblaguna|jcbcard|jcca|jcci|jcci-ps|jcci/ps|jci manila|jeepph|jeeves|jejeload|jether|jether.net|jetsitjar|jev|jfc|jfc coop|jfc-summit|jfccoop|jgsummit|jhgca|jipang|jksph|jmagsaysay|jmbantolino|jnralfamily|jobappmatch|jobmatchmkr|joinenjoy|jollibee|jollibeeuae|journey|journeytech|joyful dev|jp2academy|jrflores|jtbank|jtphils|juanmerkado|juanphils|juantel|juantel.com|jublia|junela|kabayan|kachooks|kaffea|kaia homes|kainan.mobi|kakao|kakaot|kakaotalk|kakaotalkph|kalingapl|kapandesal|kapartner|karakol.ph|karatbars|karen|kargopadala|karton.ph|kash|katpunanbnk|kaya|kaymu|kaymu.ph|kaymuph|kebhana|keds|keg|kenny|kent|kia_motors|kidsfort|kimy|kingchef|kings|kings kid|kitchenails|kkb|kloudhouse|knorr|kolents|koncustodio|konek|konek2card|kong_hua|koreafair|koreanmall|korooti|kotakbank|kps|kpsseed|kreditka|krislizz|kristin|kristn|kroger|krusada|kservico|kulula|kumoncrymnd|kuya kim|kvbank|kyani|l2phils2014|laarmonia|ladyschoice|laginghanda|lamido|lamido cs|lamido.com|lamudi|land bank|launion|lauron_law|lay-bare|laybare|lbc|lbcexpress|lbs recruit|lcku|ldb|lendwell|leongallery|leslie_lu|level x|lgorithm|lgu_cdeo|lica insure|licagroup|liceo_u|liceo_uni|lifeline|lifeprolong|light breed|lightemup|like|likecash|liloans|lindensuite|line|lineinvite|lineph|linkedin|linksys|liqpay.com|livsaf|lmepldt|loadcentral|loadmena|loadxtreme|lojc|lon_ambayec|looksery|lookus|lopez sugar|lotus cars|lourdes_cdo|loveradio|loyalcoin|lozatech|lpms|lsc|lsgh|ltt|lufthansa|luglobal|lukemaggie|lulu|lupet.com|luther|lwe|lx|lx_corp|lxcorp|lyoness|m.dutti|m.rinaldi|m2m|m2m europe|m2maccess|macempc|maco|macro kiosk|macrologic|magnetm|magnoliachx|magpie|mailapp|mailmoney|mailru|mailrugames|mailrureg|major|major-u|major_u|makaticorp|malayan|malayanbank|malixi mktg|mallofasia|management|mandalay|mango|mangoman|manila gps|manilafood|manilagps|manilahotel|manilawater|manly|manor_cjh|manulife|manulifeph|manutech|marcopolo|mari-mari|mariodboro|mark|marketing|marketlink|markt_markt|marktmarkt|marq web|marqueemall|marypaz|mashreq|mashreqbank|mass-specc|matabungkay|maxicare|maxicareph|maxiloads|maxim|maximhair|maxus|maxus phil|maxv|maxx|maxx candy|maybank|maybank cc|maybank pl|maybankcard|maybankcc|maybankloan|maymay|mayor_jon|mayor_sabil|mayor_umali|mayorony|mayorstrike|mayowin|mazda_ph|mb|mb-bbpil|mbank|mbbooking|mbjobfair|mca|mcbl|mccafe|mcdc|mcdelivery|mcdonalds|mcent|mcga|mci|mci test|mcjrdevcorp|mcjrupdates|mclinica|mcw-inc|mcwd|mdhmc|meatcentral|meatmasters|mecnetworks|mediatrix|mediatrix02|mediatrix03|mediatrix04|mediatrix05|mediatrix06|mediatrix07|mediatrix08|mediatrix09|mediatrix10|mediatrix11|mediatrix12|mediatrix13|mediatrix14|mediatrix15|medicalcity|medicard|medilink|mediserv|medlab|meemsms|mega|megacell|megaeast|megaloyalty|megarewards|megaworld|meilian|meitu|melawares|melmsalert|menosgastos|meralco|mercator|merchant74|merrell|metrixlab|metro_bank|metrobank|metrodental|metrogas|metroice|metromart|metrorem|metroretail|metrotech|mfci cebu|mfm2016|mhcc-fma|mhccares|mhcs-mab|micab|mico|microensure|microphase|microsoft|microtel|midelivery|mighty_bond|mightybond|miis|mikmagloans|milna|min_clinic|mini cooper|minicabster|misskat|mit|mite|mitsui|mjci|mjci-b&c|mjcisllbp|mk phils|mk_phils|mkumra|mla|mlabulletin|mlhuillier|mlsdental|mltlnk|mlx|mmcatv|mmdiv admin|mmdo|mmlifecoach|mmsph|mober ph|mobileminds|mobiloptima|mobip|moevenpick|mofaic|moimir|molave|momanddad|monaremit|moneyback|montelibano|monterey|montnets|monylowcost|moose01|moose02|moose03|moresco1|moresco2|motortrade|mp-alert|mpay|mpd support|mr korooti|mrta|mrxu|mscd|msginfo|msit|msn|msu|msu-iit|msweb|mtc|mtd|mtslai|mtw|mucho|mufeph|mukhamodels|multiply|mundipharma|musicmsgr|muthoot ex|mvoucher|mwalert|mwall|mwc|mwc_crm|mwc_inq|mwci|mwmakati|my wu|myblood|mycargo|mycash|mychat|mycitihomes|myclicktech|mycom|mycoopcpmpc|mycoopdmpc|mycoopgdmpc|mycraft|myhealth|myhometown|myhr|myhrasia|myinfotxt|mymail|myonesms|myoutdesk|myova|myparcel|mypayroll|mypromo|myremit|myrx|myrxph|myshuttle|myshuttleph|mystory|myvhs|naci|naicdoctors|nail it|nalmhci|nan|nankid|natasha|natcco|nateon|natgeorun|national|national bs|nationlink|natl bonds|naver|naverline|nayomi|nbi|nbk1801801|nbpm2016|ncloud|neb&suisse|nego_pinoy|neltex 2016|neltex2016|neo spa|neospa|neotrend|nephrisol|nesi|nestea|nestle|nestokid|nestokid4|net25|neteller|netflix|netplay|netplay inc|netplayinc|netrev|nettopro|netvoice|networld|neu|neutrogena|new life|newlife|newsroom|newyorkbay|nextmedia|nfs subic|ng911|ngcp-so|ni-ni|nic|nielsen|nimbuzz|nina_almoro|ninjamobs|nipponpaint|nissan|nn_nts|noble house|nokia|noove|northcarbon|northgate|northpoint|northstar|notify|notredame|notuscorp|nouveaus|novono|npi|npi.ph|npph|nrce|nsdgamrkna|ntc-m|ntrust|nutrican|nvsms1|nxsms|nxtele|nymgo|nyuad wifi|oap|obcbnk|ocdncr|ocean_park|oceanadvent|oceanadvntr|oceanpark|octaplas|octopus|odkl|ofc busters|ofo|ofw program|ogph|ohc|oicp|oicp_ectpl|oicp_it|oishi|ok remit|okayokay|okdgg|oklik|okru|olc|old navy|olpmc|omd|omg|omni|onb|onbu|one|one card|one quest|one_source|oneapi|onehalfph|onelight|onemma|onequest|onerockpmo|onesource|onestore.ph|onetagaytay|onewaysms|onlyskin|onlyskin1|ookbee|openovate|openpinoy|openport|oplata.info|opm|opmanager|opnwfi|optionfair|organo|organo gold|organogold|orix|ormeco|ort dental|ort_dental|orveo|oshnet ncr|oshnet phil|ossgsm|ostrovok.ru|otlob|otop|otp|otpsms|outback|outbox|outfit|ova|ovialand|owwa|p&g|p911|paapdc|pacific ctr|packplas|padalaplus|pag-ibig|paire|palawan_ex|palawanxprs|pamcham|panasonic|papay|pape|paraiba|parasayo|parbou|pardou|parent line|parseco|partners|partyboutiq|pasadena|pasagift|pasatreats|passport|pastornarry|patxt.me|pauw-up|payfast|payfastasia|paymaster|paymaya|paymer|paynamics|paynet|payoutplus|payreto|payroll|paysafe|payslip|pb|pbb|pbcom|pbcom_act|pbcom_alert|pbcom_bcp|pbcom_cards|pbcom_docs|pbcom_hr|pbcom_isg|pbcom_loans|pbcom_promo|pcc|pcci_ndsed|pcci_sysdev|pcci_topd|pcdc|pcl inc.|pcppi-comm|pcrg|pcso|pcsosaturn|pda107|pdb|pdc|peetow|pelicanlove|pemc|peme|penguin|percspower|perlab|perry ellis|perryellis|perx|perxasia|perxclub|pesomall|petron|petrongasul|pfa|pga ins|pgai|pgc|pharexvite|phealthcare|phil911|philcake|philcare|philcon|philcon2016|philfund|philgrocer|philhealth|philips|philperfume|philrice|philrice-tc|philriceisd|philsme|philsme.com|philstarvls|philstocks|philtech|philtrust|philweb|phinma prop|phinma_swu|phltronics|phnursesasc|phoenixfuel|phonecode|photochat|phrc2016|piasi|piazaitalia|picpa anc|picpa mmr|pifs2016|pilipinaswb|pilmico|pinasflower|pinasgift|pincd|pincode|pinkwheels|pinnacle|pinoy_genie|pinoyeats|pinoyexpres|pinoypao|pinoyrito|pioneer|pisc|pixsell|pjh_lending|plab|planbcredit|planbloans|planbmort|planters|plantersbnk|playpark|playwing|pldt home|pldt_home|pldthome|pleasantspa|pli|plivosms|pmaaai|pmco|pml:48|pml::48|pnb|pnb cards|pnb makati|pnb-sbalert|pnb_alert|pnb_cards|pnb_online|pnb_otp|pnb_promo|pnb_remit|pnbalert|pnbtest|pnbwebremit|pnp_dprm|pnpdc-admin|pnpdc-rpbs|poe2016|pointwest|pondopeso|ponds|popmsg|portia|portia2016|post.banka|potencee|pound by te|powersteel|pp_manila|ppp|ppp2015|pppcebu|pppdavao|pr|praiaz|pranicphils|pre sch-k|pre sch-nt|premiumbulk|prenagen|prestige|prevhealth|pride|prime qc|primeasia|primecast|primeland|princearis|printstagrm|privat24.ua|privatbank|prmtrc|proactive|procurement|prof_org|profile|progecad|promo|promotexter|promoticket|prop_forum|propelrr|propforum|proserve|protege|providence|proxima_sms|pru life uk|prudential|prulife|psa monitor|psa_admin|psa_monitor|psbank|pse|pshswvc|psi|psqbe|psslai|psslai loan|psslai_loan|psslailoans|ptdelta|ptr. robert|pueblo_oro|puerto-corp|punta_norte|purefoods|puregold|purepadala|pushupph|pvb|pwu|pwu_cathy|pwu_fran|px2000|pxsms|qauto|qbe|qbe rpo|qbe_rpo|qberpo|qflora|qikplate|qlick|qnfmpc|qr ph|qrevent|qrevents|qrtec|qrtecphils|quadmedia|quadritex|rabi|radiohigh|radyonatin|raffycampos|rakethost|rancho|rang-ay_bnk|ranie abu|rapid ph|rapide|rapidtxt|raymond|rb_barili|rbap|rbsp-dc-pnp|rbt_bank|rbxcollect|rcbc|rcbcbankard|rcbcmpos|rccli|rccli_iris|rcd_land|rci|rd_pawnshop|rdms|rdms inc|ready wrap|real life|realchia|realstatus|rebit|rebtel|red ribbon|reddawnhotl|reddoorz|redplanet|ree idd|ree_idd|reeidd|reetlci|regent5150|regus|rehub|rejoice|relaxant|reli_deleon|reloadex|remitbox|remitly|remora gps|rentpad|renttoownph|replika|republiq|reserveout|restohunt|ribbank|richmonde|richmondeph|rico - ann|rigensis|right-homes|ringcv|riot|rising tide|ritemed|rjc derma|rmsrecovery|robinson|robinsons|robocoin|roc.ph|rocksolid|rogomi|rolls-royce|rollsroyce|ronnie&joe|rotimum|royal cargo|royale|royalehomes|rpr_agency|rr rc|rr-rc|rr_rc|rrdelivery|rrdith|rsa|rsltph|rstech|rsvoutpromo|rue bourbon|runrio|rusty lopez|rvn|rvncloud|rvndemo|rvnhosting|rvnsales|rvnsms|rvnsupport|rwmanila|rxmedicard|sabongworld|sabre|sacredheart|saddleback|safegrd5150|safeline|sagada tour|sale now|sale oct14|sales|salon_28|salondemnl|sama|sample|sams cart|samsung|samsungph|sanbedasc|sandwichguy|sanjosekoop|sanko|sanmig|santislover|sas|satesh|saucony|saudi wages|savechild|sb cards|sb_cards|sb_equities|sb_online|sb_savings|sbc|sbc online|sbc_egc|sbcapital|sbcards col|sbcards_ccg|sbcgsd|sbegiftcard|sbequities|sbol|sbonline|sbpay|sbs|sbsmsdev|sccn|scfhs|schoolbus|sci mpc|sciventures|scteam|sdbt_bangus|seair|seasons msg|seasons otp|seasonscoln|security_bn|security_bnk|securitybnk|sedabgc|sedahotels|sen_mitos|sendah|sendah.com|sendly|sentinel|sentinelph|seo hacker|seriasia|server|servus|sexy detox|sfp|sfx church|sfx_church|shakeys|shakeys_pcm|shangri-la|shansong|sharetreats|shclwh|shell|shellcrm|sheridan|shop|shopee|shopee.ph|shopinas|shopjapan|shopmate|shoppersave|shreeweb|sics|siegen|siegen hr|sif|sigmarho|silangnat|siliconb|silkair|silver|silverair|silverfinds|silvrr|silvrrpay|silvrrwages|singleyup|singleyuppie|sip|sip ph|sip2016|sipthrills|siteheart|sitmobile|sjkoop coll|sjkoop fin|sjkoop loan|sjkoop mktg|sk|skechers|skin_mdc|skinworld|skrill|skybaguio|skybridge|skycable|skydispatch|skyjet|skyjet air|skyjetpromo|skype|sl mall|slackworkz|slcycleph|slcycleph.|slidr|slmc|slmcinfotxt|slounge|sm|sm cinema|sm mall|sm malls|sm30|sm_|sm_aura|sm_cinema|sm_ecomm|sm_makati|sm_malls|sm_megamall|sm_moa|sm_prestige|sm_sta_mesa|smac alert|smac blast|smac_alert|smac_blast|smartdeals|smartwave|smc|smc-uberhop|smc_comcon|smc_commcon|smc_corp|smcagenda|smccommcon|smdc|smepinoy|smesoft inc|smetric|smfi-gfs-sc|smfi-ssc|smgc|smiinc|smilepix|smits|smland|smmegamall|smnorthedsa|smoopay|smpc|smprime|sms uni ph|smsalert|smsbuzz|smscosc200c|smsinfo|smsouthmall|smsupermall|smx|snap|snapchat|snapster|snapworks|snapworx|snipe|snoebeauty|snorg|snow|soc land|soc_land|socland|softworld|solaire|solane|solomo|sonjas|sony_life|sophreneur|soreco|soscv phils|south star|southbank|southstar|southville|soyami|sp1 ccm|spacetrivia|spaq|spectrmfair|sperry|spi_it|splashcebu|spmg|sportstv|spot rate|spportzebra|springgame|springwood|spriza|squidcard|sremi|sriinc|srise|srlms|ssa|sscwebteam|ssi|sss|st peter|st. peter|st._patrick|stacat.coop|stalucia|stanchart|starcruises|starwood|starwoodvip|stay|steadfast|steps acctg|steps g1|steps g2|steps g3|steps g4|steps g5|steps g6|sterlngbank|sti|sti-bgc|sti-orca|stisidore|stlukes|stlukesgc|stlukesmed|stlukesqc|stmaryscoll|stnicholas|stonegrill|stpeter grp|stpeterlife|straightfwd|strava|stre3ts|streetbees|strikenews|strwoodcafe|studiomkati|submail|sulit|sulitph|sultadahan|sultana-mgt|sumitronics|suncash|suncruises|sundance|sunlife|sunrise|sunriseph|sunrisevnts|super8|super8store|supremo|surem|surf|sutherland|suthit|svi|svnscreen|swapub|sweep|sweep-otp|sweeponline|sweettreat|sybase|sym|syncrunize|syndbk|synermaxx|syrex|syrkle|systemlink|t&l|t&l2015|tagaytaynat|talent2|talinoev|talleco|tamarketing|tamasia|tamfunn|tan_gana|tanduay|tantanapp|tao_rescue|taovip|tap|tara|tara sos|tariqfarekh|tasc|taskus|tavern asia|tawagpinas|tbd|tcap|tcc|tdcprestige|tdcsafp|tdl|tdltdl|tdm support|tea 101|team gentri|team_aljay|teamasia|teamgentri|tech_towers|techno|techno_pm|technoph|techtowers|teezly|tele-perf|telegram|teleserv|teligent|telnovo|telupay|tempo|tempotext|tempotxt|temptations|tempur|tencent|tenderjuicy|teratech|terrabyte|terratek|terratekph|terrorville|text dash|text mktg.|textalerts|tfs credits|tfs notice|tfsph|tfsph rmd|tgi fridays|tgmrchandse|tgp|thaitrade|the loop|theblackpig|thebodyshop|thefoodhive|thepodium|thevillage|thinkinvest|thomas sabo|thomas_sabo|thomassabo|thread365|thrifty|ticketworld|tictoc|tihik.com|tile room|tilex|timeclickr|timeless|timewarner|timola|timsie|tipid pc|titanium|titech|tj hotdog|tlcs-abatan|tlcs-baguio|tlcs-bauko|tlcs-besao|tlcs-bontoc|tlcs-sagada|tlj|tlphils2016|tmc|tnhsdeped|tnhsgentri|tnhsnat|tnlexpress|tnllogistics|tobys|tollfoods|toluna|toniandguy|tony&jackey|top-inc|topserve|total|total ph|toto|tour_org|towers sms|towers_sms|toyota|tpbphl|tpg|tpg telecom|tracker|trakmd|tramway|trans|transavia|transfast|transportfy|tranzend|travelbook|traveloka|treats|trendmicro|trendph|tri|tri.ph|tridel|trinoma|tripcase|tripexpert|tripko|trisports|tronco|troncoad|tropo|true_north|tsa|tua|tucp|turfsiteph|tutuapp|twchat|twiincncpts|twilight|twirlr_club|twitter|txcustodio|txtcustomer|txtlink|txtmate|txtmate.com|txtventures|u-collect|u-hop|u_collect|u_mobile|uai|uber|ubp|ubp_alert|ubp_eon|ubp_umobile|ubpalert|ubpconfin|ubpebanking|ubpumobile|ucbr|ucpb|ucpbgen|ucpbjonesb|ucsaa|ucsi|ucx|uflnews|ufs|uloans|um-padala|umid|umobile|umobileuat|umpay|umraht|una batanes|una_batanes|unabasco|unarosa|unhcr|unhcr phils|unhcr_phils|unica hija|unilabftw|unilever|union-apls|union-bank|union_bank|union_pay|unionbank|unionbankph|unionpay|unisilver|unitdtowers|united neon|unitedneon|univerctee|universalex|unliride|uno-r|unolocal|unopremier|unor|upitdc|upper house|upper_house|uratex|urban-agri|urbanhive|urbanktchen|urc|us_embassy|usana ph|usanaph|usap|usls|uspf|ussc|ustcsc|utphils|v makati|valleprime|vapeboxph|vayafi|vbaliuag|vcf|vcf_kids|vcsafp|veco|ventours|verbatim|verify|verifyph|veritaspay|veterans|vexcellance|vfs|via|viacenter|viaplus|viber|vicepeter|vicsolidum|victo_natl|victory|victory-pio|victory-sr|victory_bcd|victory_drt|victorydrt|victoryfort|vietnam703|vip cards|virginamr|virginaus|vise versa|vistahome|vistaland|vk|vkcom|vma_sem|vmmorit|vmoney|vodi|voicelink|voka|volkswagen|vopium|voto mobile|vpc_promo|vpc_rebates|vpc_rewards|vpcpromo|vpcrewards|vsph|vuewin|w-ph.com|waitlistme|wakie|wallem|walletone|wan|wardrobe id|warpsms|wataniya|waters ph|waters phl|watsons|waze|wbroo|wcube|wearnes|web.uni.ph|webjuan|webmoney|webmoney.lv|wechat|weconnect|wee nam kee|weekend|weekend.ph|weekendph|weepay|wellcare|wellnesslnd|wellnesspro|welovejesus|west_union|western|westfields|westone|wesupport|whatjealous|whatsapp|whatsappph|wideout|wildfire|wimdu|win|winedepot|winnertv|wiprot|wishbone|wm check|wm mini|wm notify|wm transfer|wm-card.com|wmacel|wmarcel|wmsmssend|wonderbuy|wong|wons|wordsph|workabroad|worldnews|worldremit|wowit|wpb|wsa|wsa client|wsi|wu|wu russia|wwfphils|www.sb.lt|x-factor|xap|xapo|xde|xe|xe1|xeleb|xend|xenopharma|xiaomi|ximex|xoxo|xpressmoney|xterraphil|xupergames|xurpas|xurpas143|xush cullen|yahoo|yaje tech|yak pak|yakpak|yakult|yakult ph|yalan|yamaha|yatra|yatratravel|ybmpnt|yci|yesfm|yiss|youla|yourbrand|yourdept1|yourdept2|yourdept3|yourdept4|yourdept5|yourdept6|yourdept7|yourhusband|youroam|ys|yuneoh|z korona|zalora|zap|zebedeetrvl|zenhotels|zenitramtec|zeropest|zest air|zestair|zion send|zionsend|zionwifi|zip_travel|zipmatch|ziptel|zomato|zoomanity|zymedia|";


            $senderId = explode("|",$string,-1);

            return $senderId;
        }else{
            return redirect('error/100');
        }
    }

    public function transAccount($request){
        $start = explode("/",$request->start);
        $end = explode("/",$request->end);

        $startDate = $start[2] . "-" . $start[0] . "-" . $start[1];
        $endDate = $end[2] . "-" . $end[0] . "-" .$end[1];

        $dateRange = date_diff(date_create($startDate), date_create($endDate))->d;

        $date[] = [
            'start' => $startDate . " 00:00:01",
            'end' => $startDate . " 23:59:59"
        ];

        $column = ['sender id',$startDate];

        for($i=1; $i <= $dateRange; $i++){
            $date[] = [
               'start' => date('Y-m-d', strtotime("+$i day" . $startDate)) . " 00:00:01",
               'end' => date('Y-m-d', strtotime("+$i day" . $startDate)) . " 23:59:59"
            ];

            $column[] = date('Y-m-d', strtotime("+$i day" . $startDate));
        }

        $accountId = $this->query->table('esme_credential');
        $accountId->select('system_id','allowed_sender_ids');
        $accountId->where('esme_credential.id', $request->account);
        $accountId->get();

        $senderId = explode("|", $accountId->get()[0]->allowed_sender_ids, -1);
  
        $select[] = DB::raw("transactions.source_addr AS 'sender id'");

        foreach($senderId as $value){
            foreach($date as $eachDay){ 
                $dayStart = $eachDay['start'];
                $dayEnd = $eachDay['end'];
                $select[] = DB::raw("(CASE WHEN transactions.date_time_created BETWEEN '$dayStart' AND '$dayEnd' THEN COUNT(transactions.id) END) as '" . substr($dayStart, 0, -9) . "'");
            }
        }

        $mysql = $this->query->table('transactions');
        $mysql->select($select);
        $mysql->where('esme_credential_id', $request->account);
        $mysql->groupBy(DB::raw("transactions.source_addr"));

        return [
                'accountName' => $accountId->get()[0]->system_id,
                'column' => $column,
                'data' => $mysql->get()
            ];
    }

    public function transSender($request){
        $start = explode("/",$request->start);
        $end = explode("/",$request->end);

        $startDate = $start[2] . "-" . $start[0] . "-" . $start[1] . " 00:00:00";
        $endDate = $end[2] . "-" . $end[0] . "-" .$end[1] . " 24:59:59";

        $accountId = $this->query->table('esme_credential');
        $accountId->select('system_id');
        $accountId->where('esme_credential.id', $request->account);

        $prefix = $this->query->table('prefix');
        $prefix->select('id', 'name');

        $select[] = DB::raw("SUBSTRING(transactions.date_time_created, 1, 10) AS date");

        $network[] = "date";

        foreach($prefix->get() as $value){
            $prefix_id = $value->id;
            $prefix_name = $value->name;
            $select[] = DB::raw("(CASE WHEN transactions.prefix_id = '$prefix_id' THEN COUNT(transactions.prefix_id) END) as '$prefix_name'");

            $network[] = $value->name;
        }

        $mysql = $this->query->table('transactions');
        $mysql->select($select);
        $mysql->where([
            ['esme_credential_id', $request->account],
            ['source_addr', $request->sender]
        ]);
        $mysql->whereBetween('date_time_created', array($startDate, $endDate));
        $mysql->groupBy(DB::raw("DATE_FORMAT(transactions.date_time_created, '%Y-%m-%d')"));

        return [
            'accountName' => $accountId->get()[0]->system_id,
            'senderName' => $request->sender,
            'column' => $network,
            'data' => $mysql->get()
        ];
    }

    public function generateReport($transactions){
        $cols = "";

        foreach ($transactions->column as $value){
            $cols .= $value . ",";
            $column[] = $value;
        }

        $line[] = $cols;

        foreach ($transactions->data as $value){
            $row = "";

            foreach($column as $field){
                $row .= $value->$field . ",";
            }
            
            $line[] = $row;
        }

        $headers = array(
            "Content-type" => "text/csv",
            "Content-Disposition" => "attachment; filename=file.csv",
        );

        $path = public_path('/files/report.csv');

        $file = fopen($path, "w");

        foreach ($line as $list){
            fputcsv($file,explode(',',$list));
        }

        fclose($file);

        $filename = $transactions->accountName;

        if($transactions->type == "sender"){
            $filename .= "_" . $transactions->senderName;
        }

        $filename .= "_" . $transactions->dateRange[0] . "-" . $transactions->dateRange[0];

        return response()->download($path, str_replace("/","", $filename) . ".csv", $headers);
    }
}